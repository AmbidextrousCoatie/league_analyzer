{
  "version": "1.0.0",
  "description": "Relational schema for league analyzer (pandas-emulated or SQL)",
  "tables": [
    {
      "name": "league",
      "columns": [
        { "name": "id", "type": "string", "nullable": false, "pk": true, "description": "short id, e.g., BayL" },
        { "name": "long_name", "type": "string", "nullable": false },
        { "name": "level", "type": "integer", "nullable": false },
        { "name": "division", "type": "string", "nullable": false }
      ],
      "unique": [ ["id"] ],
      "indexes": [ ["level", "division"] ]
    },

    {
      "name": "scoring_system",
      "columns": [
        { "name": "id", "type": "string", "nullable": false, "pk": true },
        { "name": "name", "type": "string", "nullable": false },
        { "name": "points_per_individual_match_win", "type": "number", "nullable": false },
        { "name": "points_per_individual_match_tie", "type": "number", "nullable": false },
        { "name": "points_per_individual_match_loss", "type": "number", "nullable": false },
        { "name": "points_per_team_match_win", "type": "number", "nullable": false },
        { "name": "points_per_team_match_tie", "type": "number", "nullable": false },
        { "name": "points_per_team_match_loss", "type": "number", "nullable": false },
        { "name": "allow_ties", "type": "boolean", "nullable": true }
      ],
      "unique": [ ["id"] ],
      "indexes": []
    },

    {
      "name": "league_season",
      "columns": [
        { "name": "id", "type": "integer", "nullable": false, "pk": true },
        { "name": "league_id", "type": "string", "nullable": false, "fk": { "table": "league", "column": "id" } },
        { "name": "season", "type": "string", "nullable": false },
        { "name": "scoring_system_id", "type": "string", "nullable": false, "fk": { "table": "scoring_system", "column": "id" } },
        { "name": "number_of_teams", "type": "integer", "nullable": true },
        { "name": "players_per_team", "type": "integer", "nullable": true }
      ],
      "unique": [ ["league_id", "season"] ],
      "indexes": [ ["league_id", "season"] ]
    },

    {
      "name": "club",
      "columns": [
        { "name": "id", "type": "integer", "nullable": false, "pk": true },
        { "name": "name", "type": "string", "nullable": false },
        { "name": "short_name", "type": "string", "nullable": true }
      ],
      "unique": [ ["name"] ],
      "indexes": []
    },

    {
      "name": "club_town_history",
      "columns": [
        { "name": "id", "type": "integer", "nullable": false, "pk": true },
        { "name": "club_id", "type": "integer", "nullable": false, "fk": { "table": "club", "column": "id" } },
        { "name": "town", "type": "string", "nullable": false },
        { "name": "start_date", "type": "date", "nullable": false },
        { "name": "end_date", "type": "date", "nullable": true }
      ],
      "indexes": [ ["club_id", "end_date"] ]
    },

    {
      "name": "club_home_alley_history",
      "columns": [
        { "name": "id", "type": "integer", "nullable": false, "pk": true },
        { "name": "club_id", "type": "integer", "nullable": false, "fk": { "table": "club", "column": "id" } },
        { "name": "alley_name", "type": "string", "nullable": false },
        { "name": "alley_address", "type": "string", "nullable": true },
        { "name": "start_date", "type": "date", "nullable": false },
        { "name": "end_date", "type": "date", "nullable": true }
      ],
      "indexes": [ ["club_id", "end_date"] ]
    },

    {
      "name": "player",
      "columns": [
        { "name": "id", "type": "integer", "nullable": false, "pk": true },
        { "name": "given_name", "type": "string", "nullable": false },
        { "name": "family_name", "type": "string", "nullable": false },
        { "name": "full_name", "type": "string", "nullable": true },
        { "name": "date_of_birth", "type": "date", "nullable": true },
        { "name": "dominant_hand", "type": "string", "nullable": true }
      ],
      "indexes": []
    },

    {
      "name": "player_club_membership",
      "columns": [
        { "name": "id", "type": "integer", "nullable": false, "pk": true },
        { "name": "player_id", "type": "integer", "nullable": false, "fk": { "table": "player", "column": "id" } },
        { "name": "club_id", "type": "integer", "nullable": false, "fk": { "table": "club", "column": "id" } },
        { "name": "start_date", "type": "date", "nullable": false },
        { "name": "end_date", "type": "date", "nullable": true }
      ],
      "indexes": [ ["player_id", "end_date"], ["club_id", "end_date"] ]
    },

    {
      "name": "team_season",
      "columns": [
        { "name": "id", "type": "integer", "nullable": false, "pk": true },
        { "name": "league_season_id", "type": "integer", "nullable": false, "fk": { "table": "league_season", "column": "id" } },
        { "name": "club_id", "type": "integer", "nullable": false, "fk": { "table": "club", "column": "id" } },
        { "name": "team_number", "type": "integer", "nullable": false }
      ],
      "unique": [ ["league_season_id", "club_id", "team_number"] ],
      "indexes": [ ["league_season_id"], ["club_id"] ]
    },

    {
      "name": "venue",
      "columns": [
        { "name": "id", "type": "string", "nullable": false, "pk": true },
        { "name": "name", "type": "string", "nullable": false },
        { "name": "full_name", "type": "string", "nullable": true },
        { "name": "city", "type": "string", "nullable": true },
        { "name": "country", "type": "string", "nullable": true },
        { "name": "pinsetter", "type": "string", "nullable": true }
      ],
      "unique": [],
      "indexes": []
    },

    {
      "name": "venue_name",
      "columns": [
        { "name": "id", "type": "integer", "nullable": false, "pk": true },
        { "name": "venue_id", "type": "string", "nullable": false, "fk": { "table": "venue", "column": "id" } },
        { "name": "name", "type": "string", "nullable": false },
        { "name": "is_primary", "type": "boolean", "nullable": true }
      ],
      "unique": [ ["name"] ],
      "indexes": [ ["venue_id"] ]
    },

    {
      "name": "oil_pattern",
      "columns": [
        { "name": "id", "type": "integer", "nullable": false, "pk": true },
        { "name": "name", "type": "string", "nullable": false },
        { "name": "length_ft", "type": "integer", "nullable": true },
        { "name": "source_url", "type": "string", "nullable": true },
        { "name": "json_spec", "type": "string", "nullable": true }
      ],
      "unique": [],
      "indexes": []
    },

    {
      "name": "event",
      "columns": [
        { "name": "id", "type": "integer", "nullable": false, "pk": true },
        { "name": "league_season_id", "type": "integer", "nullable": true, "fk": { "table": "league_season", "column": "id" } },
        { "name": "event_type", "type": "string", "nullable": false },
        { "name": "league_week", "type": "integer", "nullable": true },
        { "name": "tournament_stage", "type": "string", "nullable": true },
        { "name": "date", "type": "date", "nullable": false },
        { "name": "venue_id", "type": "string", "nullable": false, "fk": { "table": "venue", "column": "id" } },
        { "name": "oil_pattern_id", "type": "integer", "nullable": true, "fk": { "table": "oil_pattern", "column": "id" } },
        { "name": "status", "type": "string", "nullable": true },
        { "name": "notes", "type": "string", "nullable": true }
      ],
      "indexes": [ ["league_season_id", "league_week"], ["date"] ]
    },

    {
      "name": "game_result",
      "columns": [
        { "name": "id", "type": "integer", "nullable": false, "pk": true },
        { "name": "event_id", "type": "integer", "nullable": false, "fk": { "table": "event", "column": "id" } },
        { "name": "player_id", "type": "integer", "nullable": false, "fk": { "table": "player", "column": "id" } },
        { "name": "team_season_id", "type": "integer", "nullable": true, "fk": { "table": "team_season", "column": "id" } },
        { "name": "line_no", "type": "integer", "nullable": false },
        { "name": "score", "type": "integer", "nullable": false },
        { "name": "strike_count", "type": "integer", "nullable": true },
        { "name": "spare_count", "type": "integer", "nullable": true },
        { "name": "split_count", "type": "integer", "nullable": true },
        { "name": "fouls", "type": "integer", "nullable": true },
        { "name": "handicap", "type": "number", "nullable": true },
        { "name": "is_paceline", "type": "boolean", "nullable": true }
      ],
      "unique": [ ["event_id", "player_id", "line_no"] ],
      "indexes": [ ["event_id"], ["player_id"], ["team_season_id"], ["event_id", "team_season_id"], ["event_id", "player_id"] ]
    }
  ],
  "notes": [
    "Ensure team_season.league_season_id matches event.league_season_id when inserting game_result.",
    "For current club town/home alley, filter histories where end_date is NULL.",
    "If you later add matches, introduce match and match_result tables keyed to event and team_season.",
    "Use league_season to centralize season rules; events and team participation reference it."
  ]
}
