{% extends "base.html" %}

{% block content %}
    {% include "components/tables.html" %}
    {% include "components/charts.html" %}

<div class="container-fluid">

    <!-- Filter Controls -->
    <div class="card">
        <div class="card-header">
            <h4>League Statistics</h4>
        </div>
        <div class="card-body">
            <!-- Selection Area -->
            <div class="row">
                <div class="col-md-4">
                    <h5>League</h5>
                    <div id="buttonsLeague" class="btn-group-horizontal w-100">
                        <!-- Leagues will be inserted here -->
                    </div>
                </div>
                <div class="col-md-4">
                    <h5>Season</h5>
                    <div id="buttonsSeason" class="btn-group-horizontal w-100">
                        <!-- Seasons will be inserted here -->
                    </div>
                </div>
                <div class="col-md-4">
                    <h5>Week</h5>
                    <div id="buttonsWeek" class="btn-group-horizontal w-100">
                        <!-- Weeks will be inserted here -->
                    </div>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-md-12">
                    <h5>Team</h5>
                    <div id="buttonsTeam" class="btn-group-horizontal w-100">
                        <!-- Teams will be inserted here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- League Aggregation Block (League only) -->
    <div id="leagueAggregationContainer">
        <!-- League aggregation content will be rendered here -->
        <div class="text-center py-5">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading league aggregation...</span>
            </div>
            <p class="text-muted mt-2">Initializing league aggregation...</p>
        </div>
    </div>

    <!-- League Season Overview Block (League + Season) -->
    <div id="leagueSeasonOverviewContainer">
        <!-- League season overview content will be rendered here -->
        <div class="text-center py-5">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading season overview...</span>
            </div>
            <p class="text-muted mt-2">Initializing season overview...</p>
        </div>
    </div>

    <!-- Season Overview Block (League + Season + Week/Team) -->
    <div id="seasonOverviewContainer">
        <!-- Season overview content will be rendered here -->
        <div class="text-center py-5">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading detailed overview...</span>
            </div>
            <p class="text-muted mt-2">Initializing detailed overview...</p>
        </div>
    </div>

    <!-- Match Day Block -->
    <div id="matchdayContainer">
        <!-- Match day content will be rendered here -->
        <div class="text-center py-5">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading match day content...</span>
            </div>
            <p class="text-muted mt-2">Initializing match day content...</p>
        </div>
    </div>

    <!-- Team Details Block -->
    <div id="teamDetailsContainer">
        <!-- Team details content will be rendered here -->
        <div class="text-center py-5">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading team details...</span>
            </div>
            <p class="text-muted mt-2">Initializing team details...</p>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<!-- Core dependencies -->
<script src="{{ url_for('static', filename='js/core/url-state-manager.js') }}"></script>
<script src="{{ url_for('static', filename='js/core/simple-filter-manager.js') }}"></script>
<script src="{{ url_for('static', filename='js/content-blocks/base-content-block.js') }}"></script>

<!-- Content blocks -->
<script src="{{ url_for('static', filename='js/content-blocks/league-aggregation-block.js') }}"></script>
<script src="{{ url_for('static', filename='js/content-blocks/league-season-overview-block.js') }}"></script>
<script src="{{ url_for('static', filename='js/content-blocks/season-overview-block.js') }}"></script>
<script src="{{ url_for('static', filename='js/content-blocks/matchday-block.js') }}"></script>
<script src="{{ url_for('static', filename='js/content-blocks/team-details-block.js') }}"></script>

<!-- Main application -->
<script src="{{ url_for('static', filename='js/league-stats-app.js') }}"></script>

<!-- Initialize i18n translations if available -->
{% if translations %}
<script>
    window.translations = {{ translations|tojson }};
</script>
{% endif %}

<!-- Legacy compatibility for external integrations -->
<script>
// Backward compatibility functions for external tools that might call these
window.updateAllContent = function() {
    if (window.leagueStatsApp) {
        window.leagueStatsApp.renderContent();
    }
};

window.handleSelectionChange = function() {
    if (window.leagueStatsApp) {
        window.leagueStatsApp.renderContent();
    }
};

// Make chart refresh function available globally
window.refreshAllCharts = function() {
    if (window.leagueStatsApp) {
        window.leagueStatsApp.renderContent();
    }
};
</script>
{% endblock %}