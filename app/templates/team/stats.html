{% extends "base.html" %}
{% block content %}
    {% include "components/tables.html" %}
    {% include "components/charts.html" %}

    <style>
        /* Ensure Bootstrap button styling works properly */
        .btn-check:checked + .btn-outline-primary {
            background-color: #0d6efd !important;
            border-color: #0d6efd !important;
            color: white !important;
        }
        
        .btn-check:focus + .btn-outline-primary {
            box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25) !important;
        }
    </style>

    <!-- Selection Message -->
    <div id="selectionMessage" class="alert alert-danger fs-4">
        Bitte wählen Sie ein Team.
    </div>

    <!-- Filter Controls -->
    <div class="card">
        <div class="card-header">
            <h4>Team Statistics</h4>
        </div>
        <div class="card-body">
            <!-- Selection Area -->
            <div class="row">
                <div class="col-md-3">
                    <h5>Team</h5>
                    <select id="teamSelect" class="form-select">
                        <option value="">Bitte wählen...</option>
                    </select>
                </div>
                <div class="col-md-9">
                    <h5>Saison</h5>
                    <div id="buttonsSeason" class="btn-group-horizontal w-100">
                        <!-- Seasons will be inserted here -->
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-3">
                <div class="card h-100">
                    <div class="card-header">
                        <h5>Spieltag</h5>
                    </div>
                    <div class="card-body">
                        <div id="buttonsWeek" class="btn-group-vertical w-100">
                            <!-- Buttons will be inserted here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Team History Chart -->
    <div class="row mt-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">
                    <h5>Platzierungsverlauf</h5>
                </div>
                <div class="card-body">
                    <canvas id="chartTeamHistory"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- League Comparison Section -->
    <div class="row mt-4">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5>Leistung vs. Liga-Durchschnitt</h5>
                </div>
                <div class="card-body">
                    <canvas id="chartLeagueComparison"></canvas>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h5>Liga-Vergleich Details</h5>
                </div>
                <div class="card-body">
                    <div id="tableLeagueComparison"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Clutch & Consistency Section -->
    <div class="row mt-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5>Clutch Performance</h5>
                </div>
                <div class="card-body">
                    <div id="chartClutchPerformance" style="height: 300px;"></div>
                    <div id="clutchStats" class="mt-3">
                        <!-- Clutch statistics will be displayed here -->
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5>Consistency Metrics</h5>
                </div>
                <div class="card-body">
                    <div id="consistencyMetrics">
                        <!-- Consistency metrics will be displayed here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Special Moments Section -->
    <div class="card mb-4">
        <div class="card-header">
            <h4>Besondere Momente</h4>
        </div>
        <div class="card-body">
            <div class="row">
                <!-- Highest Scores Section -->
                <div class="col-md-6 mb-4">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Höchste Ergebnisse</h5>
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Score</th>
                                        <th>Event</th>
                                        <th>Gegner</th>
                                    </tr>
                                </thead>
                                <tbody id="highestScoresBody">
                                    <!-- Will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Lowest Scores Section -->
                <div class="col-md-6 mb-4">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Niedrigste Ergebnisse</h5>
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Score</th>
                                        <th>Event</th>
                                        <th>Gegner</th>
                                    </tr>
                                </thead>
                                <tbody id="lowestScoresBody">
                                    <!-- Will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Biggest Win Margins Section -->
                <div class="col-md-6 mb-4">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Höchste Siege</h5>
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Differenz</th>
                                        <th>Ergebnis</th>
                                        <th>Event</th>
                                        <th>Gegner</th>
                                    </tr>
                                </thead>
                                <tbody id="biggestWinsBody">
                                    <!-- Will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Biggest Loss Margins Section -->
                <div class="col-md-6 mb-4">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Höchste Niederlagen</h5>
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Differenz</th>
                                        <th>Ergebnis</th>
                                        <th>Event</th>
                                        <th>Gegner</th>
                                    </tr>
                                </thead>
                                <tbody id="biggestLossesBody">
                                    <!-- Will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Import Legacy JavaScript Modules -->
    <script src="{{ url_for('static', filename='js/legacy/team-chart-utils.js') }}"></script>
    <script src="{{ url_for('static', filename='js/legacy/team-filter-utils.js') }}"></script>
    <script src="{{ url_for('static', filename='js/legacy/team-data-utils.js') }}"></script>

    <!-- Initialize Application -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize the team stats page with all functionality
            initializeTeamStatsPage();
        });
    </script>
{% endblock %}