{% extends "base.html" %}

{% block title %}Home{% endblock %}

{% block content %}
<!--h1>Bowling Dashboard</h1-->
<div class="row mt-4">
    <div class="col-md-6">
        <div class="card mb-4">
            <div class="card-header">
                Info
            </div>
            <div class="card-body">
                <!-- We'll add stats here later -->
                <p>Diese Seite ist ein Proof of Concept zur Darstellung von Ergebnissen und Statistiken rund um Bowling Ligen, Tuniere und Pokalwettbewerbe.</p>
                <p>Die Auswertungen sind oben √ºber die Navigation zu "League Stats" und "Player Stats" zu finden, ich hab auch ein paar Beispiele verlinkt.</p>
                <p>Hauptaugenmerk liegt derzeit auf den Ligastatistiken. Die meisten Daten sind fiktiv, jedoch ist die Seite so aufgabeut, dass reale Daten einfach integriert werden k√∂nnten.</p>
                <p>Ihr k√∂nnte auf den Seiten meist die Ebene der angezeigten Infos ver√§ndern, in dem ihr die Buttons f√ºr z.B. die Saison ausw√§hlt. Einfach ein wenig herumprobieren.</p>
                
                <p>Bitte kommt mit Feedback und Vorschl√§gen gerne per Whatsapp oder im Traning auf mich zu.</p>
                <p>  Cheers, Chris</p>
            </div>
        </div>       
    </div>


    <!-- New Examples Card -->
    <div class="col-md-6 mt-4">
        <div class="card">
            <div class="card-header">
                Beispiele
            </div>
            <div class="card-body">
                <ul class="list-group" id="exampleQueries">
                    <!-- Will be populated via JavaScript -->
                </ul>
            </div>
        </div>
    </div>
   
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                Letzte Events
            </div>
            <div class="card-body">
                <ul class="list-group" id="latestEvents">
                    <!-- Will be populated via JavaScript -->
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- Add JavaScript for latest events -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('üîÑ Loading latest events with database:', getCurrentDatabase());
    
    // Use fetchWithDatabase to include the database parameter
    fetchWithDatabase('{{ url_for("league.get_latest_events") }}')
        .then(response => response.json())
        .then(data => {
            //console.log('‚úÖ Latest events loaded:', data);
            const eventsList = document.getElementById('latestEvents');
            if (data && Array.isArray(data)) {
                eventsList.innerHTML = data.map(event => `
                    <li class="list-group-item">
                        <a href="{{ url_for('league.stats') }}?season=${encodeURIComponent(event.Season)}&league=${encodeURIComponent(event.League)}&week=${event.Week}&database=${encodeURIComponent(getCurrentDatabase())}" 
                           class="text-decoration-none">
                            ${event.Season} - ${event.League} - Woche ${event.Week}
                            <small class="text-muted">(${event.Date})</small>
                        </a>
                    </li>
                `).join('');
            } else {
                eventsList.innerHTML = '<li class="list-group-item">Keine Events gefunden</li>';
            }
        })
        .catch(error => {
            //console.error('‚ùå Error fetching events:', error);
            const eventsList = document.getElementById('latestEvents');
            eventsList.innerHTML = '<li class="list-group-item text-danger">Fehler beim Laden der Events</li>';
        });
    
    // Populate example queries
    const examplesList = document.getElementById('exampleQueries');
    
    // Define sample queries with labels and parameters
    const examples = [
        {
            label: 'Liga Historie (simuliert): LL 1 Nord',
            params: {
                league: 'LL 1 Nord',
                database: 'db_sim'
            }
        },
        {
            label: 'Liga Saison (simuliert): BZOL 2 Nord - 21/22',
            params: {
                season: '21/22',
                league: 'BZOL 2 Nord',
                database: 'db_sim'
            }
        },
        {
            label: 'Liga Spieltag (simuliert): BayL - 23/24 - Week 3',
            params: {
                season: '23/24',
                league: 'BayL',
                week: '3',
                database: 'db_sim'
            }
        },
        {
            label: 'Liga Spieltag (reale Daten): BayL - 24/25 - week 1',
            params: {
                season: '24/25',
                league: 'BayL',
                week: '1',
                database: 'db_real'
            }
        },
        {
            label: 'Liga Spielzettel (reale Daten): BayL - 24/25 - week 1 - BK M√ºnchen 3',
            params: {
                season: '24/25',
                league: 'BayL',
                week: '1',
                team: 'BK M√ºnchen 3',
                database: 'db_real'
            }
        },
        {
            label: 'Team Historie (simuliert): Aschaffenburg 3',
            params: {
                team: 'Aschaffenburg 3',
                database: 'db_sim'
            }
        },
        {
            label: 'Team Saison (simuliert): Aschaffenburg 3 - 23/24',
            params: {
                team: 'Aschaffenburg 3',
                season: '23/24',
                database: 'db_sim'
            }
        },
        {
            label: 'Team Historie (real): Bowlinghaus Bamberg 1',
            params: {
                team: 'Bowlinghaus Bamberg 1',
                database: 'db_real'
            }
        },
        {
            label: 'Spieler Statistiken (simuliert): Matthew Davis',
            params: {
                player_name: 'Matthew Davis',
                database: 'db_sim'
            }
        },
        {
            label: 'Spieler Statistiken (real): Altenfeld, Marco',
            params: {
                player_name: 'Altenfeld, Marco',
                database: 'db_real'
            }
        }
    ];
    
    // Generate the example links
    examplesList.innerHTML = examples.map(example => {
        // Build query string from parameters
        const params = new URLSearchParams();
        Object.entries(example.params).forEach(([key, value]) => {
            if (value) {
                params.set(key, value);
            }
        });
        
        const queryString = params.toString();
        
        // Determine the appropriate URL based on the example type
        let url;
        if (example.label.includes('Spieler Statistiken')) {
            url = `{{ url_for('player.stats') }}?${queryString}`;
        } else if (example.label.includes('Team')) {
            url = `{{ url_for('team.stats') }}?${queryString}`;
        } else {
            url = `{{ url_for('league.stats') }}?${queryString}`;
        }
        
        return `
            <li class="list-group-item">
                <a href="${url}" 
                   class="text-decoration-none">
                    ${example.label}
                </a>
            </li>
        `;
    }).join('');
});
</script>
{% endblock %} 